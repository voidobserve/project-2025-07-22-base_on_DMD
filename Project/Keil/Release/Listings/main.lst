C51 COMPILER V9.60.7.0   MAIN                                                              08/15/2025 17:22:18 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Release\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\main.c LARGE OPTIMIZE(9,SIZE) BROWSE ORDER INTVECTOR(0X000C) 
                    -INCDIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\
                    -Listings\main.lst) OBJECT(.\Release\Objects\main.obj)

line level    source

   1          /**
   2           ******************************************************************************
   3           * @file    main.c
   4           * @author  HUGE-IC Application Team
   5           * @version V1.0.0
   6           * @date    05-11-2022
   7           * @brief   Main program body
   8           ******************************************************************************
   9           * @attention
  10           *
  11           * <h2><center>&copy; COPYRIGHT 2021 HUGE-IC</center></h2>
  12           *
  13           * ç‰ˆæƒè¯´æ˜åç»­è¡¥ä¸Š
  14           *
  15           ******************************************************************************
  16           */
  17          
  18          /* Includes ------------------------------------------------------------------*/
  19          #include "include.h"
  20          #include "my_config.h"
  21          
  22          // DEBUG
  23          // volatile bit flag_is_debug_update = 0; // æµ‹è¯•æ—¶ä½¿ç”¨
  24          // volatile bit flag_debug_is_send_time = 0; // æµ‹è¯•æ—¶ä½¿ç”¨
  25          // volatile bit flag_debug_is_send_time_2 = 0; // æµ‹è¯•æ—¶ä½¿ç”¨
  26          
  27          void user_init(void)
  28          {
  29   1          // æ§åˆ¶ä¸Šç”µæŒ‡ç¤ºç¯çš„å¼•è„šï¼š
  30   1          P2_MD0 &= ~(GPIO_P23_MODE_SEL(0x03)); // æ¸…ç©ºå¯„å­˜å™¨é…ç½®
  31   1          P2_MD0 |= GPIO_P23_MODE_SEL(0x01);    // è¾“å‡ºæ¨¡å¼
  32   1          FOUT_S23 |= GPIO_FOUT_AF_FUNC;
  33   1      
  34   1          // tmr0_config();  // ä¸²å£æ£€æµ‹æ•°æ®è¶…æ—¶éœ€è¦ä½¿ç”¨åˆ°çš„å®šæ—¶å™¨
  35   1          uart0_config(); // å‘é€å’Œæ¥æ”¶æŒ‡ä»¤ä½¿ç”¨åˆ°çš„ä¸²å£
  36   1      
  37   1      #if PIN_LEVEL_SCAN_ENABLE
  38   1          pin_level_scan_config(); // åˆ¹è½¦ã€è½¬å‘ç¯ã€æŒ¡ä½çš„æ£€æµ‹å¼•è„šé…ç½®
  39   1      #endif
  40   1      
  41   1          tmr1_config(); // æ£€æµ‹ä¸€æ®µæ—¶é—´å†…çš„è„‰å†²ä¸ªæ•°æ‰€éœ€çš„å®šæ—¶å™¨(ç”¨äºè®¡æ—¶)
  42   1      
  43   1      #if SPEED_SCAN_ENABLE
  44   1          speed_scan_config(); // æ—¶é€Ÿæ‰«æçš„é…ç½®
  45   1      #endif                   // SPEED_SCAN_ENABLE
  46   1      
  47   1      #if ENGINE_SPEED_SCAN_ENABLE
                  engine_speed_scan_config(); // å‘åŠ¨æœºè½¬é€Ÿæ‰«æçš„é…ç½®
              #endif                          // #if ENGINE_SPEED_SCAN_ENABLE
  50   1      
  51   1      #if (BATTERY_SCAN_ENABLE || AD_KEY_ENABLE || FUEL_CAPACITY_SCAN_ENABLE || TEMP_OF_WATER_SCAN_ENABLE)
  52   1          adc_config();
  53   1      #endif
C51 COMPILER V9.60.7.0   MAIN                                                              08/15/2025 17:22:18 PAGE 2   

  54   1      
  55   1      #if TOUCH_KEY_ENABLE
                  tk_param_init(); // è§¦æ‘¸æŒ‰é”®æ¨¡å—åˆå§‹åŒ–
              #endif
  58   1      
  59   1      #if IC_1302_ENABLE
  60   1          aip1302_config(); // åˆå§‹åŒ–æ—¶é’Ÿicï¼Œå‡½æ•°å†…éƒ¨ä¼šè¯»å–æ—¶é—´ä¿¡æ¯ï¼Œå¹¶å­˜æ”¾åˆ°å…¨å±€å˜é‡ä
             -¸­
  61   1      #endif
  62   1      
  63   1          tmr2_config(); // æ‰«æè„‰å†²(ç”µå¹³å˜åŒ–)çš„å®šæ—¶å™¨
  64   1      
  65   1          // tmr1_enable(); // æ‰“å¼€ æ£€æµ‹å¼•è„šç”µå¹³ã€æ£€æµ‹æ—¶é€Ÿã€å‘åŠ¨æœºè½¬é€Ÿã€æ›´æ–°é‡Œç¨‹ã€å®šæ—
             -¶æ£€æµ‹æ²¹é‡ ä½¿ç”¨çš„å®šæ—¶å™¨ ã€ç°åœ¨ç›´æ¥æ”¾åˆ°äº†tmr1_config()å‡½æ•°ä¸­ã€‘
  66   1          // tmr2_enable(); // æ‰“å¼€å®šæ—¶æ£€æµ‹è„‰å†²çš„å®šæ—¶å™¨
  67   1      
  68   1          iic_config();
  69   1      
  70   1          // eeprom_24cxx_clear(); // å…¨ç‰‡æ“¦é™¤
  71   1      
  72   1          // printf("begin read eeprom\n");
  73   1          fun_info_init(); // åˆå§‹åŒ–ç”¨äºå­˜æ”¾ä¿¡æ¯çš„å˜é‡ï¼ˆè¦æ”¾åœ¨iicåˆå§‹åŒ–åé¢ï¼‰
  74   1      
  75   1          // delay_ms(10); // ç­‰å¾…ç³»ç»Ÿç¨³å®š
  76   1          delay_ms(1); // ç­‰å¾…ç³»ç»Ÿç¨³å®š
  77   1          // delay_ms(2000); // ç­‰å¾…ç³»ç»Ÿç¨³å®š
  78   1      }
  79          
  80          void main(void)
  81          {
  82   1          // çœ‹é—¨ç‹—é»˜è®¤æ‰“å¼€, å¤ä½æ—¶é—´2s
  83   1          system_init();
  84   1      
  85   1          // WDT_KEY = WDT_KEY_VAL(0xDD); //  å…³é—­çœ‹é—¨ç‹—
  86   1      
  87   1          // å…³é—­HCKå’ŒHDAçš„è°ƒè¯•åŠŸèƒ½
  88   1          WDT_KEY = 0x55;  // è§£é™¤å†™ä¿æŠ¤
  89   1          IO_MAP &= ~0x01; // æ¸…é™¤è¿™ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œå®ç°å…³é—­HCKå’ŒHDAå¼•è„šçš„è°ƒè¯•åŠŸèƒ½ï¼ˆè§£é™¤æ
             -˜ å°„ï¼‰
  90   1          WDT_KEY = 0xBB;
  91   1      
  92   1          /* ç”¨æˆ·ä»£ç åˆå§‹åŒ–æ¥å£ */
  93   1          user_init();
  94   1      
  95   1          // æµ‹è¯•ç”¨åˆ°çš„é…ç½®ï¼š
  96   1          // P1_MD0 &= (~GPIO_P11_MODE_SEL(0x3));
  97   1          // P1_MD0 |= GPIO_P11_MODE_SEL(0x1); // è¾“å‡ºæ¨¡å¼
  98   1          // FOUT_S11 |= GPIO_FOUT_AF_FUNC;
  99   1          // P11 = 0;
 100   1          // P2_MD0 &= ~GPIO_P20_MODE_SEL(0x3); // æ¸…ç©ºå¯¹åº”çš„é…ç½®
 101   1          // P2_MD0 |= GPIO_P20_MODE_SEL(0x1);  // è¾“å‡ºæ¨¡å¼
 102   1          // FOUT_S20 |= GPIO_FOUT_AF_FUNC;
 103   1          // P20 = 0;
 104   1      
 105   1          // printf("sys reset\n");
 106   1      
 107   1          // ä¸Šç”µåï¼Œéœ€è¦ç‚¹äº®ä¸€ä¸‹æ‰€æœ‰çš„æŒ‡ç¤ºç¯ï¼Œå†å…³é—­:
 108   1          P23 = 1;
 109   1          delay_ms(1000);
 110   1          P23 = 0;
 111   1      
 112   1      #if 0  // æµ‹è¯•å‘é€æ—¥æœŸå’Œæ—¶é—´
C51 COMPILER V9.60.7.0   MAIN                                                              08/15/2025 17:22:18 PAGE 3   

                  // å½“å‰æ—¥æœŸ
                  fun_info.aip1302_saveinfo.year = 2024;
                  fun_info.aip1302_saveinfo.month = 12;
                  fun_info.aip1302_saveinfo.day = 05;
              
                  // å½“å‰æ—¶é—´
                  fun_info.aip1302_saveinfo.time_hour = 13;
                  fun_info.aip1302_saveinfo.time_min = 45;
                  fun_info.aip1302_saveinfo.time_sec = 32;
              
                  aip1302_update_all_data(fun_info.aip1302_saveinfo);
              
                  printf("year %u month %bu day %bu \n", fun_info.aip1302_saveinfo.year, fun_info.aip1302_saveinfo.month
             -, fun_info.aip1302_saveinfo.day);
                  printf("hour %bu min %bu sec %bu \n", fun_info.aip1302_saveinfo.time_hour, fun_info.aip1302_saveinfo.t
             -ime_min, fun_info.aip1302_saveinfo.time_sec);
              #endif // æµ‹è¯•å‘é€æ—¥æœŸå’Œæ—¶é—´
 128   1      
 129   1          // printf("sys reset\n");
 130   1      
 131   1          // æµ‹è¯•ç¨‹åºï¼š
 132   1          // fun_info.save_info.total_mileage = (u32)999970 * 1000;
 133   1          // // fun_info.save_info.subtotal_mileage = (u32)999970 * 100;
 134   1          // fun_info.save_info.subtotal_mileage = (u32)99997 * 100;
 135   1          // // fun_info.save_info.subtotal_mileage = (u32)10051 * 100;
 136   1          // fun_info.save_info.subtotal_mileage_2 = (u32)999970 * 100;
 137   1      
 138   1          /* ç³»ç»Ÿä¸»å¾ªç¯ */
 139   1          while (1)
 140   1          {
 141   2              // printf("main circle\n");
 142   2      
 143   2      #if 1
 144   2              WDT_KEY = WDT_KEY_VAL(0xAA); // å–‚ç‹—å¹¶æ¸…é™¤ wdt_pending
 145   2      
 146   2      #if TOUCH_KEY_ENABLE
                      /* æŒ‰é”®æ‰«æå‡½æ•° */
                      __tk_scan();                 // ä½¿ç”¨äº†åº“é‡Œé¢çš„æ¥å£ï¼ˆé—­æºåº“ï¼‰
                      WDT_KEY = WDT_KEY_VAL(0xAA); // å–‚ç‹—å¹¶æ¸…é™¤ wdt_pending
              #endif
 151   2      
 152   2      #if AD_KEY_ENABLE
                      key_driver_scan(&ad_key_para);
                      ad_key_handle(); // adæŒ‰é”®å¤„ç†å‡½æ•°
              #endif                   //  #if AD_KEY_ENABLE
 156   2      
 157   2      #if TOUCH_KEY_ENABLE
                      key_driver_scan(&touch_key_para);
                      touch_key_handle(); // è§¦æ‘¸æŒ‰é”®å¤„ç†å‡½æ•°
              #endif
 161   2      #if PIN_LEVEL_SCAN_ENABLE
 162   2              pin_level_scan();
 163   2      #endif
 164   2      #if SPEED_SCAN_ENABLE
 165   2      
 166   2              speed_scan(); // æ£€æµ‹æ—¶é€Ÿ
 167   2      #endif                // #if SPEED_SCAN_ENABLE
 168   2      
 169   2      #if ENGINE_SPEED_SCAN_ENABLE
                      engine_speed_scan(); // æ£€æµ‹å‘åŠ¨æœºè½¬é€Ÿ
              #endif                       // #if ENGINE_SPEED_SCAN_ENABLE
 172   2              mileage_scan();      // æ£€æµ‹å¤§è®¡é‡Œç¨‹å’Œå°è®¡é‡Œç¨‹
C51 COMPILER V9.60.7.0   MAIN                                                              08/15/2025 17:22:18 PAGE 4   

 173   2      
 174   2      #if FUEL_CAPACITY_SCAN_ENABLE
 175   2              fuel_capacity_scan(); // æ²¹é‡æ£€æµ‹
 176   2      #endif                        // FUEL_CAPACITY_SCAN_ENABLE
 177   2      #if BATTERY_SCAN_ENABLE
                      battery_scan(); // ç”µæ± ç”µé‡æ£€æµ‹
              #endif                  // BATTERY_SCAN_ENABLE
 180   2      
 181   2              uart0_scan_handle();  // æ£€æŸ¥ä¸²å£æ¥æ”¶ç¼“å†²åŒºçš„æ•°æ®æ˜¯å¦ç¬¦åˆåè®®,å¦‚æœæœ‰æ­£ç¡®çš„
             -æŒ‡ä»¤ï¼Œä¼šå­˜åˆ°å¦ä¸€ä¸ªç¼“å†²åŒºä¸­ï¼ˆæ¥ä¸‹æ¥è®©instruction_scan()å‡½æ•°æ¥å¤„ç†ï¼‰
 182   2              instruction_scan();   // æ‰«ææ˜¯å¦æœ‰åˆæ³•çš„æŒ‡ä»¤
 183   2              instruction_handle(); // æ‰«ææ˜¯å¦æœ‰å¯¹åº”çš„è·å–/çŠ¶æ€æ›´æ–°æ“ä½œ(æœ€å ç”¨æ—¶é—´,å› ä¸ºè
             -¦ç­‰å¾…ä¸²å£çš„æ•°æ®å‘é€å®Œæˆ)
 184   2      
 185   2              // DEBUG:
 186   2              // if (flag_debug_is_send_time)
 187   2              // {
 188   2              //     eeprom_printf_all();
 189   2              //     flag_debug_is_send_time = 0;
 190   2              // }
 191   2      
 192   2      #endif //
 193   2      
 194   2              // aip1302_test();
 195   2              // {
 196   2              //     u8 ret = 0;
 197   2              //     ret = aip1302_is_running();
 198   2              //     if (ret)
 199   2              //     {
 200   2              //         // å¦‚æœæ—¶é’ŸèŠ¯ç‰‡aip1302çš„æ™¶æŒ¯æ­£åœ¨è¿è¡Œ
 201   2              //         printf("aip1302 is running\n");
 202   2              //     }
 203   2              //     else
 204   2              //     {
 205   2              //         // å¦‚æœæ—¶é’ŸèŠ¯ç‰‡aip1302çš„æ™¶æŒ¯ä¸åœ¨è¿è¡Œ
 206   2              //         printf("aip1302 is sleep\n");
 207   2              //     }
 208   2              // }
 209   2      
 210   2              // AIP1302_CE_PIN = 1;
 211   2              // delay_ms(500);
 212   2              // AIP1302_CE_PIN = 0;
 213   2              // delay_ms(500);
 214   2      
 215   2              // heart_beat_handle(); //
 216   2      
 217   2              // WDT_KEY = WDT_KEY_VAL(0xAA); // å–‚ç‹—å¹¶æ¸…é™¤ wdt_pending
 218   2          }
 219   1      }
 220          
 221          /**
 222           * @}
 223           */
 224          
 225          /*************************** (C) COPYRIGHT 2022 HUGE-IC ***** END OF FILE *****/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    105    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.60.7.0   MAIN                                                              08/15/2025 17:22:18 PAGE 5   

   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
